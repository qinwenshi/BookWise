# BookWise 笔记同步功能演示

## 功能概述

BookWise 现已集成 Cloudflare R2 存储的笔记同步功能，允许用户在多设备间同步笔记数据。

## 主要功能

### 1. R2 配置管理
- **位置**: 设置页面 → 同步设置
- **功能**: 
  - 配置 R2 端点、存储桶名称
  - 设置访问密钥和秘密密钥
  - 启用/禁用同步功能
  - 测试连接状态

### 2. 自动同步
- **触发时机**: 
  - 添加新笔记时自动上传
  - 更新笔记时自动同步
  - 删除笔记时自动清理远程数据
- **同步状态**: 实时显示在笔记页面导航栏

### 3. 同步状态指示器
- **位置**: 笔记页面导航栏右上角
- **状态类型**:
  - 🔄 同步中
  - ✅ 已启用并配置
  - ❌ 错误状态
  - ⚪ 未配置

### 4. 手动同步
- **位置**: 设置页面 → 同步设置
- **功能**: 
  - 手动触发完整同步
  - 查看同步日志
  - 测试 R2 连接

## 技术实现

### 核心组件

1. **R2ConfigManager** (`src/renderer/src/shared/r2-config.ts`)
   - 管理 R2 配置信息
   - 本地存储配置数据
   - 提供配置验证功能

2. **S3Client** (`src/renderer/src/shared/s3-client.ts`)
   - 实现 S3 兼容的 API 客户端
   - 支持 AWS Signature V4 签名
   - 提供上传、下载、删除操作

3. **NoteSyncService** (`src/renderer/src/shared/note-sync-service.ts`)
   - 核心同步逻辑
   - 处理本地与远程数据同步
   - 管理同步状态和错误处理

4. **UI 组件**
   - `SyncSettings.vue`: 同步设置界面
   - `SyncStatus.vue`: 同步状态指示器

### 数据流程

```
本地笔记操作 → NoteAction → NoteSyncService → S3Client → Cloudflare R2
```

## 使用指南

### 1. 配置 R2 存储

1. 打开 BookWise 应用
2. 进入设置页面
3. 找到"同步设置"部分
4. 填写以下信息：
   - **R2 端点**: `https://your-account.r2.cloudflarestorage.com`
   - **存储桶名称**: 您的 R2 存储桶名称
   - **访问密钥 ID**: R2 API 令牌的访问密钥
   - **秘密访问密钥**: R2 API 令牌的秘密密钥

### 2. 测试连接

1. 配置完成后，点击"测试连接"按钮
2. 系统会验证配置是否正确
3. 连接成功后，启用同步功能

### 3. 使用同步功能

1. 启用同步后，所有笔记操作将自动同步
2. 在笔记页面可以查看同步状态
3. 可以手动触发完整同步

## 安全特性

- 使用 AWS Signature V4 进行安全认证
- 配置信息本地加密存储
- 支持 HTTPS 传输加密
- 错误处理和重试机制

## 故障排除

### 常见问题

1. **连接失败**
   - 检查网络连接
   - 验证 R2 配置信息
   - 确认 API 令牌权限

2. **同步失败**
   - 查看同步日志
   - 检查存储桶权限
   - 验证网络稳定性

3. **配置丢失**
   - 重新输入配置信息
   - 检查本地存储权限

### 技术支持

如遇到问题，请检查：
1. 浏览器控制台错误信息
2. 同步设置页面的错误提示
3. R2 存储桶的访问日志

## 开发说明

### 扩展功能

如需扩展同步功能，可以：

1. 修改 `NoteSyncService` 添加新的同步策略
2. 扩展 `SyncSettings.vue` 添加更多配置选项
3. 在 `NoteAction` 中添加更多同步触发点

### 测试

使用提供的测试页面 `test-sync.html` 进行功能验证。

---

**注意**: 此功能需要有效的 Cloudflare R2 账户和配置。请确保您的 R2 存储桶具有适当的权限设置。